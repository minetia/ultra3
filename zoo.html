<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS ZOO MUTE</title>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ğŸŒ‘ ë‹¤í¬ ì¿¨í†¤ í…Œë§ˆ ğŸŒ‘ */
        :root {
            --bg: #000000;
            --panel: #111;
            --text: #eee;
            --green: #00E676; 
            --red: #FF1744;   
            
            --dog-bg: #1565c0; --dog-txt: #fff;
            --cat-bg: #4a148c; --cat-txt: #fff;
            --mouse-bg: #004d40; --mouse-txt: #e0f2f1;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { 
            background-color: var(--bg); color: var(--text); 
            font-family: 'Pretendard', sans-serif;
            height: 100vh; width: 100vw; overflow: hidden; 
            display: flex; flex-direction: column; 
        }

        /* 1. ìƒë‹¨ ì •ë³´ì°½ */
        header {
            height: 50px; background: var(--panel); padding: 0 15px;
            border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        .seed-info { font-size: 11px; color: #888; }
        .seed-val { font-size: 14px; font-weight: bold; color: #fff; margin-left: 5px;}
        .pnl-rate { font-size: 12px; font-weight: bold; margin-left: 5px; }
        .live-price { font-size: 18px; font-weight: 800; color: var(--green); }

        /* 2. ì‹œìŠ¤í…œ ë²„íŠ¼ ì¡´ */
        .system-zone {
            height: 45px; background: #0a0a0a; border-bottom: 1px solid #333;
            display: flex; gap: 10px; padding: 5px 15px; align-items: center;
        }
        .sys-btn {
            flex: 1; height: 32px; border-radius: 8px; border: 1px solid #333;
            font-weight: bold; font-size: 12px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: 0.2s; color: #fff; background: #1a1a1a;
        }
        #btn-auto.auto-on { background: linear-gradient(90deg, #ff9800, #ff5722); border: none; animation: pulse 1.5s infinite; }
        #btn-wallet:active { background: #333; }

        /* 3. ê°œì½”ì›ìˆ­ì´ ì¡´ */
        #baboon-zone {
            height: 80px; background: #0a0a0a; 
            display: flex; justify-content: space-around; align-items: flex-end;
            padding-bottom: 5px; border-bottom: 1px solid #333;
            flex-shrink: 0; position: relative;
        }
        .baboon-wrapper { position: relative; width: 25%; text-align: center; }
        .baboon-face { font-size: 30px; transition: transform 0.1s; cursor: pointer; }
        .baboon-label { font-size: 9px; color: #666; font-weight: bold; margin-top: 2px; }
        
        .speech-bubble {
            position: absolute; bottom: 45px; left: 50%; transform: translateX(-50%) scale(0);
            background: #fff; color: #000; padding: 4px 8px; border-radius: 8px; 
            font-size: 11px; font-weight: bold; white-space: nowrap; opacity: 0; transition: 0.2s;
            border: 2px solid #000; z-index: 50; box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }
        .speech-bubble::after { content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%); border-width: 4px; border-style: solid; border-color: #fff transparent transparent transparent; }
        .speaking { transform: translateX(-50%) scale(1); opacity: 1; }
        .shake { animation: shake 0.3s infinite; }

        /* 4. ì°¨íŠ¸ */
        #tv_chart_container { flex: 1; width: 100%; background: #000; }

        /* 5. ì±„íŒ…ë°© */
        .chat-room {
            height: 25%; background: #080808; 
            padding: 10px; overflow-y: auto; display: flex; flex-direction: column; gap: 6px;
            border-top: 1px solid #333; flex-shrink: 0;
        }
        .msg { display: flex; align-items: flex-end; gap: 8px; animation: slideIn 0.2s; }
        .avatar { font-size: 20px; min-width: 25px; text-align: center; cursor: pointer; } /* í´ë¦­ ê°€ëŠ¥ í‘œì‹œ */
        .avatar:active { transform: scale(0.9); }
        .bubble { 
            padding: 8px 12px; border-radius: 12px; font-size: 12px; max-width: 90%;
            font-weight: 500; border: 1px solid rgba(255,255,255,0.05); line-height: 1.4;
        }
        .dog { flex-direction: row-reverse; } .dog .bubble { background: var(--dog-bg); color: var(--dog-txt); }
        .cat { flex-direction: row; } .cat .bubble { background: var(--cat-bg); color: var(--cat-txt); }
        .mouse { justify-content: center; } .mouse .bubble { background: var(--mouse-bg); color: var(--mouse-txt); font-size: 11px; }
        
        .sys-msg { text-align: center; color: #888; font-size: 11px; margin: 5px 0; border: 1px dashed #333; padding: 2px; border-radius: 4px; }

        /* 6. ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
        .controls {
            height: 70px; background: var(--panel); padding: 5px;
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px;
            border-top: 1px solid #333; flex-shrink: 0;
        }
        .btn {
            border: none; border-radius: 6px; font-weight: 800; font-size: 11px; 
            color: #fff; cursor: pointer; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; transition: 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-l-buy { background: #1B5E20; border: 1px solid #00E676; }
        .btn-l-sell { background: #004D40; border: 1px solid #00E676; opacity: 0.3; pointer-events: none;}
        .btn-s-buy { background: #B71C1C; border: 1px solid #FF1744; }
        .btn-s-sell { background: #880E4F; border: 1px solid #FF1744; opacity: 0.3; pointer-events: none;}
        .active-btn { opacity: 1 !important; pointer-events: auto !important; }

        /* 7. ì§€ê°‘ ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .wallet-card {
            width: 90%; max-height: 80%; background: #1a1a1a;
            border: 1px solid #444; border-radius: 16px;
            display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .wallet-header { padding: 15px; background: #222; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .history-list { flex: 1; overflow-y: auto; padding: 10px; }
        .history-item { display: flex; justify-content: space-between; padding: 12px; border-bottom: 1px solid #333; font-size: 13px; animation: slideIn 0.2s; }
        .type-long { color: #00E676; } .type-short { color: #FF1744; }
        .plus { color: #00E676; } .minus { color: #FF1744; }

        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(10deg); } 75% { transform: rotate(-10deg); } 100% { transform: rotate(0deg); } }
        @keyframes slideIn { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <header>
        <div>
            <span class="seed-info">ì‹œë“œ:</span>
            <span id="balance" class="seed-val">10,000</span>
            <span id="pnl-rate" class="pnl-rate" style="color:#888;">(0.00%)</span>
        </div>
        <div id="price-display" class="live-price">Loading...</div>
    </header>

    <div class="system-zone">
        <button id="btn-auto" class="sys-btn" onclick="bot.toggleAuto()">
            <i class="fas fa-robot"></i> <span id="auto-text">ìë™ë§¤ë§¤ OFF</span>
        </button>
        <button id="btn-wallet" class="sys-btn" onclick="bot.openWallet()">
            <i class="fas fa-wallet"></i> ë‚´ ì§€ê°‘
        </button>
    </div>

    <div id="baboon-zone">
        <div class="baboon-wrapper"><div id="msg-1" class="speech-bubble"></div><div id="face-1" class="baboon-face" onclick="bot.action(1)">ğŸµ</div><div class="baboon-label" style="color:#00E676">ë¡± ì§„ì…</div></div>
        <div class="baboon-wrapper"><div id="msg-2" class="speech-bubble"></div><div id="face-2" class="baboon-face" onclick="bot.action(2)">ğŸ™‰</div><div class="baboon-label" style="color:#00E676">ë¡± ì •ì‚°</div></div>
        <div class="baboon-wrapper"><div id="msg-3" class="speech-bubble"></div><div id="face-3" class="baboon-face" onclick="bot.action(3)">ğŸ™ˆ</div><div class="baboon-label" style="color:#FF1744">ìˆ ì§„ì…</div></div>
        <div class="baboon-wrapper"><div id="msg-4" class="speech-bubble"></div><div id="face-4" class="baboon-face" onclick="bot.action(4)">ğŸ™Š</div><div class="baboon-label" style="color:#FF1744">ìˆ ì •ì‚°</div></div>
    </div>

    <div id="tv_chart_container"></div>

    <div class="chat-room" id="chat-box">
        <div class="msg mouse">
            <div class="avatar" onclick="bot.toggleChatter()">ğŸ­</div>
            <div class="bubble">ì°! ì‹œë„ëŸ¬ìš°ë©´ ë‚´ ì–¼êµ´ì„ ëˆŒëŸ¬ë¼ ì°! ì¡°ìš©íˆ í•˜ê² ë‹¤ ì°! ğŸ”‡</div>
        </div>
    </div>

    <div class="controls">
        <button id="btn-1" class="btn btn-l-buy" onclick="bot.action(1)">ğŸµ ë¡± ë§¤ìˆ˜</button>
        <button id="btn-2" class="btn btn-l-sell" onclick="bot.action(2)">ğŸ™‰ ë¡± ì •ë¦¬</button>
        <button id="btn-3" class="btn btn-s-buy" onclick="bot.action(3)">ğŸ™ˆ ìˆ ë§¤ìˆ˜</button>
        <button id="btn-4" class="btn btn-s-sell" onclick="bot.action(4)">ğŸ™Š ìˆ ì •ë¦¬</button>
    </div>

    <div id="wallet-modal" class="modal-overlay">
        <div class="wallet-card">
            <div class="wallet-header">
                <div class="wallet-title" style="color:white; font-weight:bold;"><i class="fas fa-receipt"></i> ê±°ë˜ ë‚´ì—­</div>
                <button style="background:none; border:none; color:#fff; font-size:18px;" onclick="bot.closeWallet()">âœ•</button>
            </div>
            <div id="history-list" class="history-list"></div>
        </div>
    </div>

    <script>
        new TradingView.widget({
            "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "1", "timezone": "Asia/Seoul",
            "theme": "dark", "style": "1", "locale": "kr", "toolbar_bg": "#f1f3f6", "enable_publishing": false,
            "hide_top_toolbar": true, "container_id": "tv_chart_container",
            "disabled_features": ["use_localstorage_for_settings"], "enabled_features": ["hide_left_toolbar_by_default"]
        });

        class ZooBot {
            constructor() {
                this.startBalance = 10000;
                this.balance = 10000;
                this.position = null; 
                this.price = 0;
                this.lastPrice = 0;
                this.isAuto = false;
                this.history = [];
                this.isChatting = true; // ëŒ€í™” ì¼œì§ ìƒíƒœ
                
                // AI ë‹¨ì–´ì¥ (Vocabulary)
                this.vocab = {
                    dog: {
                        intro: ["ì™€ìš°!", "ì£¼ì¸ë‹˜!", "ì„¸ìƒì—!", "ì €ê¸°ìš”!", "ë©ë©!", "ê¼¬ë¦¬ ì‚´ë‘!", "í—¥í—¥!", "í‚í‚!", "ì‹ ë‚œë‹¤!"],
                        market_up: ["ì°¨íŠ¸ê°€ ìŠ¹ì²œí•´ìš”", "ì–‘ë´‰ì´ ì†Ÿêµ¬ì³ìš”", "ëˆ ë³µì‚¬ê¸° ê°€ë™ëì–´ìš”", "ì§€ê¸ˆ ë¡± ì•ˆì‚¬ë©´ ë°”ë³´ë˜ìš”", "ìš°ì£¼ ëê¹Œì§€ ê°€ìš”"],
                        market_down: ["ì¡°ì •ì¼ ë¿ì´ì—ìš”", "ì„¸ì¼ ê¸°ê°„ì´ì—ìš”", "ê²ë¨¹ì§€ ë§ˆì„¸ìš”", "ê±´ê°•í•œ ì¡°ì •ì´ì—ìš”", "ì¤ì¤ ì°¬ìŠ¤ì—ìš”"],
                        my_win: ["ê°„ì‹ë¹„ ë²Œì—ˆì–´ìš”!", "ì†Œê³ ê¸° ì‚¬ì£¼ì„¸ìš”!", "ì‚°ì±… ê°ˆê¹Œìš”?", "ë¶€ì ëì–´ìš”!", "ì œ ë•ë¶„ì´ì—ìš”!"],
                        my_lose: ["ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ìš”...", "ì¡´ë²„ëŠ” ìŠ¹ë¦¬í•´ìš”...", "ì†ì ˆì€ ì•ˆë¼ìš”...", "ë¼ˆë‹¤ê·€ í•˜ë‚˜ë§Œ ì£¼ì„¸ìš”...", "ì£¼ì¸ë‹˜ ë¯¿ì–´ìš”..."],
                        end: ["ê°€ì¦ˆì•„!", "í’€ë§¤ìˆ˜!", "í™”ì´íŒ…!", "ì‚¬ë‘í•´ìš”!", "ì¶©ì„±!", "ë©!"]
                    },
                    cat: {
                        intro: ["í•˜...", "ì•¼ì˜¹.", "ë¹„ì¼œë´.", "ì¯§ì¯§.", "í•œì‹¬í•˜êµ°.", "ì§‘ì‚¬ì•¼.", "ì–´íœ´.", "ì‹œë„ëŸ½ë‹¤ëƒ¥."],
                        market_up: ["ê°œë¯¸ ê¼¬ì‹œê¸°ë‹¤ëƒ¥", "ê³§ ì„¤ê±°ì§€ ë‚˜ì˜¨ë‹¤ëƒ¥", "ë”í™©ì³ë¼ëƒ¥", "ê°€ì§œ ë°˜ë“±ì´ë‹¤ëƒ¥", "ê±°ë˜ëŸ‰ì´ ìˆ˜ìƒí•˜ë‹¤ëƒ¥"],
                        market_down: ["ë‚˜ë½ ê°„ë‹¤ëƒ¥", "ì§€ì˜¥ë¬¸ ì—´ë ¸ë‹¤ëƒ¥", "í•œê°• ë¬¼ ì²´í¬í•´ë¼ëƒ¥", "ì‹œì›í•˜ê²Œ ë–¨ì–´ì§„ë‹¤ëƒ¥", "ìˆì´ ì§„ë¦¬ë‹¤ëƒ¥"],
                        my_win: ["ìš´ì´ ì¢‹ì•˜ë‹¤ëƒ¥", "ì¸„ë¥´ê°’ì€ ë²Œì—ˆë‹¤ëƒ¥", "ë‚´ê°€ ë­ë¬ëƒëƒ¥", "ì´ê²Œ ì‹¤ë ¥ì´ë‹¤ëƒ¥", "ê°ì‚¬íˆ ì—¬ê²¨ë¼ëƒ¥"],
                        my_lose: ["ë‚´ ëˆ ì–´ë””ê°”ëƒ¥", "ì§‘ì‚¬ê°€ ë§ì³¤ë‹¤ëƒ¥", "ë°¥ êµ¶ê²Œ ìƒê²¼ë‹¤ëƒ¥", "ì²­ì‚° ë‹¹í•˜ê³  ì‹¶ëƒ¥", "ì§œì¦ë‚œë‹¤ëƒ¥"],
                        end: ["ì •ì‹ ì°¨ë ¤ë¼ëƒ¥.", "ë‘ê³ ë³´ë¼ëƒ¥.", "ì ì´ë‚˜ ìë¼ëƒ¥.", "í•œì‹¬í•˜ë‹¤ëƒ¥.", "ê³µë¶€ ì¢€ í•´ë¼ëƒ¥."]
                    },
                    mouse: {
                        intro: ["ì°!", "ìœ¼ì•…!", "í˜•ë‹˜ë“¤!", "ì €ê¸°...", "ì‚´ë ¤ì¤˜ìš”!", "íˆìµ!", "ë‘ë¦¬ë²ˆ...", "í°ì¼ë‚¬ë‹¤!"],
                        market_up: ["ë„ˆë¬´ ë†’ì•„ìš” ì°", "ê³ ì†Œê³µí¬ì¦ ìˆë‹¤ ì°", "ë–¨ì–´ì§ˆê±° ê°™ë‹¤ ì°", "ë¹¨ë¦¬ íŒ”ì ì°", "ìš•ì‹¬ ë¶€ë¦¬ì§€ë§ˆ ì°"],
                        market_down: ["ë°”ë‹¥ì´ ì—†ë‹¤ ì°", "ê³ ë˜ í˜•ë‹˜ë“¤ ì‹¸ìš´ë‹¤ ì°", "ì¹˜ì¦ˆ ë‹¤ ë…¹ëŠ”ë‹¤ ì°", "ì§€êµ¬ ë©¸ë§ì´ë‹¤ ì°", "ë‹¤ ì£½ëŠ”ë‹¤ ì°"],
                        my_win: ["ì¹˜ì¦ˆ í•œì¡°ê° ê±´ì¡Œë‹¤ ì°", "1ë¶ˆì´ë¼ë„ ì±™ê¸°ì ì°", "ë„ë§ì¹˜ì ì°", "ê°ì‚¬í•©ë‹ˆë‹¤ ì°", "ì‹¬ì¥ì´ ë›´ë‹¤ ì°"],
                        my_lose: ["ë‚´ ì „ì¬ì‚°ì´ë‹¤ ì°", "ê³ ì–‘ì´í•œí…Œ ì¡ì•„ë¨¹íŒë‹¤ ì°", "ì‚´ë ¤ì£¼ì„¸ìš” ì°", "ë‹¤ì‹  ì•ˆí• ê±°ë‹¤ ì°", "ì†ì´ ë–¨ë¦°ë‹¤ ì°"],
                        end: ["ìˆ¨ì–´ì•¼ì§€ ì°...", "êµ¬ë©ìœ¼ë¡œ ì™...", "ë¬´ì„œì›Œ ì°...", "ì§‘ì— ê°ˆë˜ ì°...", "ê¸°ë„í•˜ì ì°..."]
                    }
                };

                this.fetchPrice();
                setInterval(() => this.fetchPrice(), 1000);
                
                // ğŸ—£ï¸ AI ìˆ˜ë‹¤ ì—”ì§„ ê°€ë™ (0.8ì´ˆë§ˆë‹¤)
                setInterval(() => this.generateSentence(), 800);
            }

            async fetchPrice() {
                try {
                    const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
                    const data = await res.json();
                    this.lastPrice = this.price;
                    this.price = parseFloat(data.price);
                    this.updateHeader();
                } catch(e) {}
            }

            // ============================================
            // ğŸ”‡ ëŒ€í™” ì •ì§€/ì‹œì‘ í† ê¸€
            // ============================================
            toggleChatter() {
                this.isChatting = !this.isChatting;
                const box = document.getElementById('chat-box');
                const div = document.createElement('div');
                div.className = 'sys-msg';
                
                if(!this.isChatting) {
                    div.innerText = "ğŸ”‡ ë™ë¬¼ë“¤ì´ ì¡°ìš©í•´ì¡ŒìŠµë‹ˆë‹¤. (í´ë¦­í•˜ì—¬ ì¼œê¸°)";
                } else {
                    div.innerText = "ğŸ”Š ë™ë¬¼ë“¤ì´ ë‹¤ì‹œ ë– ë“¤ê¸° ì‹œì‘í•©ë‹ˆë‹¤!";
                }
                
                box.appendChild(div);
                box.scrollTop = box.scrollHeight;
            }

            // ============================================
            // ğŸ§  AI ë¬¸ì¥ ìƒì„±ê¸°
            // ============================================
            generateSentence() {
                if(!this.isChatting) return; // ëŒ€í™” êº¼ì ¸ìˆìœ¼ë©´ ì¤‘ë‹¨

                // 1. í™”ì ëœë¤ ì„ íƒ
                const animals = ['dog', 'cat', 'mouse'];
                const who = animals[Math.floor(Math.random() * animals.length)];
                
                // 2. í˜„ì¬ ìƒíƒœ ë¶„ì„
                let sentiment = 'neutral';
                const pnl = this.position ? ((this.price - this.position.entry) / this.position.entry * (this.position.type==='LONG'?1:-1)) : 0;
                
                // 3. ë‹¨ì–´ì¥ ì„ íƒ
                const dict = this.vocab[who];
                let parts = [];

                parts.push(this.pick(dict.intro));

                if(this.position && Math.random() > 0.4) {
                    if(pnl > 0) parts.push(this.pick(dict.my_win));
                    else parts.push(this.pick(dict.my_lose));
                } else {
                    if(this.price > this.lastPrice) parts.push(this.pick(dict.market_up));
                    else parts.push(this.pick(dict.market_down));
                }

                parts.push(this.pick(dict.end));

                const fullSentence = parts.join(" ");
                this.talk(who, fullSentence);
            }

            pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

            // ì±„íŒ… UI ì¶œë ¥ (í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€ë¨)
            talk(who, text) {
                const div = document.createElement('div');
                div.className = `msg ${who}`;
                const avatar = who==='dog' ? 'ğŸ¶' : (who==='cat'?'ğŸ±':'ğŸ­');
                
                // [ì¤‘ìš”] ì•„ë°”íƒ€ì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
                div.innerHTML = `<div class="avatar" onclick="bot.toggleChatter()">${avatar}</div><div class="bubble">${text}</div>`;
                
                const box = document.getElementById('chat-box');
                box.appendChild(div);
                box.scrollTop = box.scrollHeight;
                if(box.children.length > 50) box.removeChild(box.firstChild);
            }

            // ============================================
            // ğŸ¤– ìë™ë§¤ë§¤ & ì§€ê°‘ & ë²„íŠ¼ ì•¡ì…˜
            // ============================================
            toggleAuto() {
                this.isAuto = !this.isAuto;
                const btn = document.getElementById('btn-auto');
                const txt = document.getElementById('auto-text');
                
                if(this.isAuto) {
                    btn.classList.add('auto-on');
                    txt.innerText = "ìë™ë§¤ë§¤ ON";
                    this.talk('dog', "ì œê°€ ì•Œì•„ì„œ ëˆ ë²Œì–´ì˜¬ê²Œìš”!");
                    this.autoTimer = setInterval(() => {
                        if(Math.random() > 0.7) {
                            if(this.position) this.action(this.position.type === 'LONG' ? 2 : 4);
                            else this.action(Math.random() > 0.5 ? 1 : 3);
                        }
                    }, 2000);
                } else {
                    btn.classList.remove('auto-on');
                    txt.innerText = "ìë™ë§¤ë§¤ OFF";
                    this.talk('cat', "í¥, ê²°êµ­ ìˆ˜ë™ì´ëƒì˜¹.");
                    clearInterval(this.autoTimer);
                }
            }

            openWallet() {
                document.getElementById('wallet-modal').style.display = 'flex';
                this.renderHistory();
            }
            closeWallet() { document.getElementById('wallet-modal').style.display = 'none'; }

            addHistory(type, price, profit) {
                const now = new Date();
                const timeStr = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
                this.history.unshift({ time: timeStr, type, price, profit });
            }

            renderHistory() {
                const list = document.getElementById('history-list');
                if(this.history.length === 0) { list.innerHTML = "<div style='text-align:center; color:#555; padding:20px;'>ê±°ë˜ ë‚´ì—­ ì—†ìŒ</div>"; return; }
                let html = "";
                this.history.forEach(h => {
                    const profitClass = h.profit > 0 ? 'plus' : (h.profit < 0 ? 'minus' : '');
                    const typeClass = h.type.includes('LONG') ? 'type-long' : 'type-short';
                    const profitStr = h.profit !== 0 ? (h.profit > 0 ? `+${Math.floor(h.profit)}` : Math.floor(h.profit)) : '-';
                    html += `<div class="history-item"><div><span style="color:#666; font-size:10px;">${h.time}</span> <span class="${typeClass}" style="font-weight:bold;">${h.type}</span></div><div class="${profitClass}">${profitStr} $</div></div>`;
                });
                list.innerHTML = html;
            }

            action(id) {
                if(this.price === 0) return;

                if(id === 1 && !this.position) {
                    this.position = { type: 'LONG', entry: this.price, amount: this.balance };
                    this.shout(1, this.price.toLocaleString());
                    this.toggleBtns(true, 'LONG');
                    this.addHistory('LONG ì§„ì…', this.price, 0);
                }
                else if(id === 2 && this.position) {
                    this.closePosition(2);
                }
                else if(id === 3 && !this.position) {
                    this.position = { type: 'SHORT', entry: this.price, amount: this.balance };
                    this.shout(3, this.price.toLocaleString());
                    this.toggleBtns(true, 'SHORT');
                    this.addHistory('SHORT ì§„ì…', this.price, 0);
                }
                else if(id === 4 && this.position) {
                    this.closePosition(4);
                }
            }

            closePosition(baboonId) {
                const diff = (this.price - this.position.entry) / this.position.entry;
                const pnlRate = this.position.type === 'LONG' ? diff : -diff;
                const profit = this.position.amount * pnlRate;
                this.balance += profit;
                
                const sign = profit > 0 ? "+" : "";
                this.shout(baboonId, `${sign}${Math.floor(profit)}`); 
                this.addHistory(`${this.position.type} ì²­ì‚°`, this.price, profit);
                
                this.position = null;
                this.toggleBtns(false);
                this.updateHeader();
                if(document.getElementById('wallet-modal').style.display === 'flex') this.renderHistory();
            }

            shout(id, text) {
                const bubble = document.getElementById(`msg-${id}`);
                const face = document.getElementById(`face-${id}`);
                bubble.innerText = text;
                bubble.classList.add('speaking');
                face.classList.add('shake');
                setTimeout(() => { bubble.classList.remove('speaking'); face.classList.remove('shake'); }, 2000);
            }

            toggleBtns(hasPos, type) {
                const b1 = document.getElementById('btn-1'); const b2 = document.getElementById('btn-2');
                const b3 = document.getElementById('btn-3'); const b4 = document.getElementById('btn-4');
                b1.classList.remove('active-btn'); b2.classList.remove('active-btn');
                b3.classList.remove('active-btn'); b4.classList.remove('active-btn');
                if(!hasPos) { b1.classList.add('active-btn'); b3.classList.add('active-btn'); }
                else { if(type === 'LONG') b2.classList.add('active-btn'); else b4.classList.add('active-btn'); }
            }

            updateHeader() {
                const elPrice = document.getElementById('price-display');
                elPrice.innerText = this.price.toLocaleString(undefined, {minimumFractionDigits: 2});
                if(this.position) {
                     const isWin = (this.position.type === 'LONG' && this.price > this.position.entry) || (this.position.type === 'SHORT' && this.price < this.position.entry);
                     elPrice.style.color = isWin ? '#00E676' : '#FF1744';
                } else elPrice.style.color = '#fff';
                document.getElementById('balance').innerText = Math.floor(this.balance).toLocaleString();
                const totalPnl = this.balance - this.startBalance;
                const pnlPercent = (totalPnl / this.startBalance) * 100;
                const elRate = document.getElementById('pnl-rate');
                const sign = totalPnl >= 0 ? "+" : "";
                elRate.innerText = `(${sign}${pnlPercent.toFixed(2)}%)`;
                if(totalPnl > 0) elRate.style.color = '#00E676';
                else if(totalPnl < 0) elRate.style.color = '#FF1744';
                else elRate.style.color = '#888';
            }
        }

        const bot = new ZooBot();
    </script>
</body>
</html>
