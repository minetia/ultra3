<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEXUS ZOO SYSTEM (FINAL)</title>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ğŸŒ‘ ë‹¤í¬ ì¿¨í†¤ í…Œë§ˆ ğŸŒ‘ */
        :root {
            --bg: #000000;
            --panel: #111;
            --text: #eee;
            --green: #00E676; 
            --red: #FF1744;   
            --blue: #2979FF;
            
            --dog-bg: #1565c0; --dog-txt: #fff;
            --cat-bg: #4a148c; --cat-txt: #fff;
            --mouse-bg: #004d40; --mouse-txt: #e0f2f1;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg); color: var(--text); 
            font-family: 'Pretendard', sans-serif;
            /* ëª¨ë°”ì¼ ë†’ì´ ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ dvh ì‚¬ìš© */
            height: 100vh; 
            height: 100dvh; 
            width: 100vw; overflow: hidden; 
            display: flex; flex-direction: column; 
        }

        /* [1] ìƒë‹¨ ì •ë³´ì°½ (ê³ ì • ë†’ì´) */
        header {
            height: 45px; background: var(--panel); padding: 0 15px;
            border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center;
            flex-shrink: 0;
        }
        .seed-info { font-size: 11px; color: #888; }
        .seed-val { font-size: 14px; font-weight: bold; color: #fff; margin-left: 5px;}
        .pnl-rate { font-size: 12px; font-weight: bold; margin-left: 5px; }
        .live-price { font-size: 16px; font-weight: 800; color: var(--green); }

        /* [2] ì‹œìŠ¤í…œ ë²„íŠ¼ ì¡´ (ê³ ì • ë†’ì´) */
        .system-zone {
            height: 45px; background: #0a0a0a; border-bottom: 1px solid #333;
            display: flex; gap: 8px; padding: 5px 15px; align-items: center;
            flex-shrink: 0;
        }
        .sys-btn {
            flex: 1; height: 32px; border-radius: 6px; border: 1px solid #333;
            font-weight: bold; font-size: 12px; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 6px;
            transition: 0.2s; color: #fff; background: #1a1a1a;
        }
        
        #btn-auto.auto-on { background: linear-gradient(90deg, #ff9800, #ff5722); border: none; box-shadow: 0 0 10px rgba(255,87,34,0.4); animation: pulse 1.5s infinite; }
        #btn-wallet:active { background: #333; }

        /* [3] ê°œì½”ì›ìˆ­ì´ ì¡´ (ê³ ì • ë†’ì´) */
        #baboon-zone {
            height: 75px; background: #0a0a0a; 
            display: flex; justify-content: space-around; align-items: flex-end;
            padding-bottom: 5px; border-bottom: 1px solid #333;
            flex-shrink: 0; position: relative;
        }
        .baboon-wrapper { position: relative; width: 25%; text-align: center; }
        .baboon-face { font-size: 28px; transition: transform 0.1s; cursor: pointer; }
        .baboon-label { font-size: 9px; color: #666; font-weight: bold; margin-top: 2px; }
        
        .speech-bubble {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%) scale(0);
            background: #fff; color: #000; padding: 3px 6px; border-radius: 6px; 
            font-size: 10px; font-weight: bold; white-space: nowrap; opacity: 0; transition: 0.2s;
            border: 2px solid #000; z-index: 50; box-shadow: 0 2px 5px rgba(0,0,0,0.5); pointer-events: none;
        }
        .speech-bubble::after {
            content: ''; position: absolute; bottom: -4px; left: 50%; transform: translateX(-50%);
            border-width: 4px; border-style: solid; border-color: #fff transparent transparent transparent;
        }
        .speaking { transform: translateX(-50%) scale(1); opacity: 1; }
        .shake { animation: shake 0.3s infinite; }

        /* [4] ì°¨íŠ¸ (ë‚¨ëŠ” ê³µê°„ ì „ë¶€ ì°¨ì§€) */
        #tv_chart_container { flex: 1; width: 100%; background: #000; min-height: 0; }

        /* [5] ì±„íŒ…ë°© (ê³ ì • ë†’ì´) */
        .chat-room {
            height: 140px; background: #080808; 
            padding: 10px; overflow-y: auto; display: flex; flex-direction: column; gap: 6px;
            border-top: 1px solid #333; flex-shrink: 0;
        }
        .msg { display: flex; align-items: flex-end; gap: 8px; animation: slideIn 0.2s; }
        .avatar { font-size: 18px; min-width: 20px; text-align: center; }
        .bubble { 
            padding: 6px 10px; border-radius: 10px; font-size: 12px; max-width: 85%;
            font-weight: 500; border: 1px solid rgba(255,255,255,0.05); line-height: 1.4;
        }
        .dog { flex-direction: row-reverse; } .dog .bubble { background: var(--dog-bg); color: var(--dog-txt); }
        .cat { flex-direction: row; } .cat .bubble { background: var(--cat-bg); color: var(--cat-txt); }
        .mouse { justify-content: center; } .mouse .bubble { background: var(--mouse-bg); color: var(--mouse-txt); font-size: 11px; }

        /* [6] ìˆ˜ë™ ì»¨íŠ¸ë¡¤ ë²„íŠ¼ (í•˜ë‹¨ ê³ ì •) */
        .controls {
            height: 60px; background: var(--panel); padding: 5px;
            display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px;
            border-top: 1px solid #333; flex-shrink: 0;
            /* ì•„ì´í° í•˜ë‹¨ ë°” ëŒ€ì‘ */
            padding-bottom: max(5px, env(safe-area-inset-bottom));
        }
        .btn {
            border: none; border-radius: 6px; font-weight: 800; font-size: 11px; 
            color: #fff; cursor: pointer; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; transition: 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        
        .btn-l-buy { background: #1B5E20; border: 1px solid #00E676; }
        .btn-l-sell { background: #004D40; border: 1px solid #00E676; opacity: 0.3; pointer-events: none;}
        .btn-s-buy { background: #B71C1C; border: 1px solid #FF1744; }
        .btn-s-sell { background: #880E4F; border: 1px solid #FF1744; opacity: 0.3; pointer-events: none;}
        .active-btn { opacity: 1 !important; pointer-events: auto !important; }

        /* [7] ì§€ê°‘ íŒì—… (Modal) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(5px);
        }
        .wallet-card {
            width: 90%; max-height: 80%; background: #1a1a1a;
            border: 1px solid #444; border-radius: 16px;
            display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .wallet-header {
            padding: 15px; background: #222; border-bottom: 1px solid #333;
            display: flex; justify-content: space-between; align-items: center;
        }
        .wallet-title { font-size: 16px; font-weight: bold; color: #fff; display: flex; gap: 8px; align-items: center; }
        .close-modal { background: none; border: none; color: #888; font-size: 20px; cursor: pointer; }
        
        .history-list {
            flex: 1; overflow-y: auto; padding: 10px;
        }
        .history-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 12px; border-bottom: 1px solid #333;
            font-size: 13px; animation: slideIn 0.2s;
        }
        .h-time { font-size: 10px; color: #666; display: block; margin-bottom: 2px; }
        .h-type { font-weight: bold; padding: 2px 6px; border-radius: 4px; font-size: 11px; }
        .type-long { background: rgba(0, 230, 118, 0.1); color: #00E676; }
        .type-short { background: rgba(255, 23, 68, 0.1); color: #FF1744; }
        .h-profit { font-weight: bold; }
        .plus { color: #00E676; } .minus { color: #FF1744; }

        @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(10deg); } 75% { transform: rotate(-10deg); } 100% { transform: rotate(0deg); } }
        @keyframes slideIn { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <header>
        <div>
            <span class="seed-info">ì‹œë“œ:</span>
            <span id="balance" class="seed-val">10,000</span>
            <span id="pnl-rate" class="pnl-rate" style="color:#888;">(0.00%)</span>
        </div>
        <div id="price-display" class="live-price">Loading...</div>
    </header>

    <div class="system-zone">
        <button id="btn-auto" class="sys-btn" onclick="bot.toggleAuto()">
            <i class="fas fa-robot"></i> <span id="auto-text">ìë™ë§¤ë§¤ OFF</span>
        </button>
        <button id="btn-wallet" class="sys-btn" onclick="bot.openWallet()">
            <i class="fas fa-wallet"></i> ë‚´ ì§€ê°‘ (ë‚´ì—­)
        </button>
    </div>

    <div id="baboon-zone">
        <div class="baboon-wrapper">
            <div id="msg-1" class="speech-bubble">96,500</div>
            <div id="face-1" class="baboon-face" onclick="bot.action(1)">ğŸµ</div>
            <div class="baboon-label" style="color:#00E676">ë¡± ì§„ì…</div>
        </div>
        <div class="baboon-wrapper">
            <div id="msg-2" class="speech-bubble">+500</div>
            <div id="face-2" class="baboon-face" onclick="bot.action(2)">ğŸ™‰</div>
            <div class="baboon-label" style="color:#00E676">ë¡± ì •ì‚°</div>
        </div>
        <div class="baboon-wrapper">
            <div id="msg-3" class="speech-bubble">96,500</div>
            <div id="face-3" class="baboon-face" onclick="bot.action(3)">ğŸ™ˆ</div>
            <div class="baboon-label" style="color:#FF1744">ìˆ ì§„ì…</div>
        </div>
        <div class="baboon-wrapper">
            <div id="msg-4" class="speech-bubble">+500</div>
            <div id="face-4" class="baboon-face" onclick="bot.action(4)">ğŸ™Š</div>
            <div class="baboon-label" style="color:#FF1744">ìˆ ì •ì‚°</div>
        </div>
    </div>

    <div id="tv_chart_container"></div>

    <div class="chat-room" id="chat-box">
        <div class="msg mouse">
            <div class="avatar">ğŸ­</div>
            <div class="bubble">ì°! í™”ë©´ ì•ˆ ì˜ë¦¬ê²Œ ê³µì‚¬ ë‹¤ í–ˆë‹¤ ì°! ì´ì œ ì¾Œì í•˜ë‹¤ ì°! ğŸ› ï¸</div>
        </div>
    </div>

    <div class="controls">
        <button id="btn-1" class="btn btn-l-buy" onclick="bot.action(1)">ğŸµ ë¡± ë§¤ìˆ˜</button>
        <button id="btn-2" class="btn btn-l-sell" onclick="bot.action(2)">ğŸ™‰ ë¡± ì •ë¦¬</button>
        <button id="btn-3" class="btn btn-s-buy" onclick="bot.action(3)">ğŸ™ˆ ìˆ ë§¤ìˆ˜</button>
        <button id="btn-4" class="btn btn-s-sell" onclick="bot.action(4)">ğŸ™Š ìˆ ì •ë¦¬</button>
    </div>

    <div id="wallet-modal" class="modal-overlay">
        <div class="wallet-card">
            <div class="wallet-header">
                <div class="wallet-title">
                    <i class="fas fa-receipt"></i> ê±°ë˜ ë‚´ì—­ (ì¥ë¶€)
                </div>
                <button class="close-modal" onclick="bot.closeWallet()">âœ•</button>
            </div>
            <div id="history-list" class="history-list">
                <div style="text-align:center; color:#555; padding:20px;">ì•„ì§ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
            </div>
        </div>
    </div>

    <script>
        new TradingView.widget({
            "autosize": true, "symbol": "BINANCE:BTCUSDT", "interval": "1", "timezone": "Asia/Seoul",
            "theme": "dark", "style": "1", "locale": "kr", "toolbar_bg": "#f1f3f6", "enable_publishing": false,
            "hide_top_toolbar": true, "container_id": "tv_chart_container",
            "disabled_features": ["use_localstorage_for_settings"], "enabled_features": ["hide_left_toolbar_by_default"]
        });

        class ZooBot {
            constructor() {
                this.startBalance = 10000;
                this.balance = 10000;
                this.position = null; 
                this.price = 0;
                this.isAuto = false;
                this.autoTimer = null;
                this.history = [];
                
                this.fetchPrice();
                // [ìˆ˜ì •ë¨] ê°€ê²© ê°±ì‹  ì£¼ê¸°ë¥¼ 0.5ì´ˆë¡œ ë‹¨ì¶• (ì°¨íŠ¸ ì˜¤ì°¨ ìµœì†Œí™”)
                setInterval(() => this.fetchPrice(), 500);
                setInterval(() => this.randomChatter(), 2000);
            }

            async fetchPrice() {
                try {
                    const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT');
                    const data = await res.json();
                    this.price = parseFloat(data.price);
                    this.updateHeader();
                } catch(e) {}
            }

            toggleAuto() {
                this.isAuto = !this.isAuto;
                const btn = document.getElementById('btn-auto');
                const txt = document.getElementById('auto-text');

                if (this.isAuto) {
                    btn.classList.add('auto-on');
                    txt.innerText = "ìë™ë§¤ë§¤ ON";
                    this.talk('dog', "ë©! ì œê°€ ì•Œì•„ì„œ ë§¤ë§¤í• ê²Œìš”! ì£¼ì¸ë‹˜ì€ ì‰¬ì„¸ìš”!");
                    this.talk('mouse', "ì°! AI ì•Œê³ ë¦¬ì¦˜ ê°€ë™í•œë‹¤ ì°! ğŸ§ ");
                    this.autoTimer = setInterval(() => this.autoTradeLogic(), 3000);
                } else {
                    btn.classList.remove('auto-on');
                    txt.innerText = "ìë™ë§¤ë§¤ OFF";
                    this.talk('cat', "í¥. ê²°êµ­ ìˆ˜ë™ìœ¼ë¡œ í•˜ê² ë‹¤ëƒ¥? ëª»ë¯¸ë¥ë‹¤ëƒ¥.");
                    clearInterval(this.autoTimer);
                }
            }

            autoTradeLogic() {
                if(this.price === 0) return;
                const r = Math.random();
                if (this.position) {
                    if (r > 0.7) { 
                        const actionId = this.position.type === 'LONG' ? 2 : 4;
                        this.action(actionId);
                    }
                } else {
                    if (r > 0.6) { 
                        const type = Math.random() > 0.5 ? 1 : 3;
                        this.action(type);
                    }
                }
            }

            openWallet() {
                document.getElementById('wallet-modal').style.display = 'flex';
                this.renderHistory();
                this.talk('mouse', "ì°! ì¥ë¶€ ê°€ì ¸ì™”ë‹¤ ì°! ê¼¼ê¼¼íˆ ë´ë¼ ì°!");
            }

            closeWallet() {
                document.getElementById('wallet-modal').style.display = 'none';
            }

            addHistory(type, price, profit) {
                const now = new Date();
                const timeStr = `${now.getHours()}:${now.getMinutes()}:${now.getSeconds()}`;
                
                this.history.unshift({
                    time: timeStr,
                    type: type,
                    price: price,
                    profit: profit
                });
            }

            renderHistory() {
                const list = document.getElementById('history-list');
                if(this.history.length === 0) {
                    list.innerHTML = "<div style='text-align:center; color:#555; padding:20px;'>ì•„ì§ ê±°ë˜ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>";
                    return;
                }

                let html = "";
                this.history.forEach(h => {
                    const typeClass = h.type.includes('LONG') ? 'type-long' : 'type-short';
                    const profitClass = h.profit > 0 ? 'plus' : (h.profit < 0 ? 'minus' : '');
                    const profitStr = h.profit !== 0 ? (h.profit > 0 ? `+${Math.floor(h.profit)}` : Math.floor(h.profit)) : '-';
                    
                    html += `
                    <div class="history-item">
                        <div>
                            <span class="h-time">${h.time}</span>
                            <span class="h-type ${typeClass}">${h.type}</span>
                            <span style="margin-left:5px;">@${h.price.toLocaleString()}</span>
                        </div>
                        <div class="h-profit ${profitClass}">${profitStr} $</div>
                    </div>`;
                });
                list.innerHTML = html;
            }

            action(id) {
                if(this.price === 0) return;

                if(id === 1) { 
                    if(this.position) return;
                    this.position = { type: 'LONG', entry: this.price, amount: this.balance };
                    this.shout(1, this.price.toLocaleString());
                    this.toggleBtns(true, 'LONG');
                    this.addHistory('LONG ì§„ì…', this.price, 0);
                    if(!this.isAuto) this.talk('dog', "ë©! ë¡± ì¡ì•˜ë‹¤!");
                }
                else if(id === 2) { 
                    if(!this.position) return;
                    this.closePosition(2);
                }
                else if(id === 3) { 
                    if(this.position) return;
                    this.position = { type: 'SHORT', entry: this.price, amount: this.balance };
                    this.shout(3, this.price.toLocaleString());
                    this.toggleBtns(true, 'SHORT');
                    this.addHistory('SHORT ì§„ì…', this.price, 0);
                    if(!this.isAuto) this.talk('cat', "ìˆ ì³¤ë‹¤ëƒ¥!");
                }
                else if(id === 4) { 
                    if(!this.position) return;
                    this.closePosition(4);
                }
            }

            closePosition(baboonId) {
                const diff = (this.price - this.position.entry) / this.position.entry;
                const pnlRate = this.position.type === 'LONG' ? diff : -diff;
                const profit = this.position.amount * pnlRate;
                
                this.balance += profit;
                const sign = profit > 0 ? "+" : "";
                this.shout(baboonId, `${sign}${Math.floor(profit)}`); 

                this.addHistory(`${this.position.type} ì²­ì‚°`, this.price, profit);

                this.position = null;
                this.toggleBtns(false);
                this.updateHeader();
                
                if(document.getElementById('wallet-modal').style.display === 'flex') {
                    this.renderHistory();
                }
            }

            shout(id, text) {
                const bubble = document.getElementById(`msg-${id}`);
                const face = document.getElementById(`face-${id}`);
                bubble.innerText = text;
                bubble.classList.add('speaking');
                face.classList.add('shake');
                setTimeout(() => { bubble.classList.remove('speaking'); face.classList.remove('shake'); }, 2000);
            }

            talk(who, text) {
                const div = document.createElement('div');
                div.className = `msg ${who}`;
                const avatar = who==='dog' ? 'ğŸ¶' : (who==='cat'?'ğŸ±':'ğŸ­');
                div.innerHTML = `<div class="avatar">${avatar}</div><div class="bubble">${text}</div>`;
                const box = document.getElementById('chat-box');
                box.appendChild(div);
                box.scrollTop = box.scrollHeight;
                if(box.children.length > 50) box.removeChild(box.firstChild);
            }

            toggleBtns(hasPos, type) {
                const b1 = document.getElementById('btn-1');
                const b2 = document.getElementById('btn-2');
                const b3 = document.getElementById('btn-3');
                const b4 = document.getElementById('btn-4');

                b1.classList.remove('active-btn'); b2.classList.remove('active-btn');
                b3.classList.remove('active-btn'); b4.classList.remove('active-btn');

                if(!hasPos) {
                    b1.classList.add('active-btn'); b3.classList.add('active-btn');
                } else {
                    if(type === 'LONG') b2.classList.add('active-btn');
                    else b4.classList.add('active-btn');
                }
            }

            updateHeader() {
                const elPrice = document.getElementById('price-display');
                elPrice.innerText = this.price.toLocaleString(undefined, {minimumFractionDigits: 2});
                if(this.position) {
                     const isWin = (this.position.type === 'LONG' && this.price > this.position.entry) || (this.position.type === 'SHORT' && this.price < this.position.entry);
                     elPrice.style.color = isWin ? '#00E676' : '#FF1744';
                } else elPrice.style.color = '#fff';
                document.getElementById('balance').innerText = Math.floor(this.balance).toLocaleString();
                const totalPnl = this.balance - this.startBalance;
                const pnlPercent = (totalPnl / this.startBalance) * 100;
                const elRate = document.getElementById('pnl-rate');
                const sign = totalPnl >= 0 ? "+" : "";
                elRate.innerText = `(${sign}${pnlPercent.toFixed(2)}%)`;
                if(totalPnl > 0) elRate.style.color = '#00E676';
                else if(totalPnl < 0) elRate.style.color = '#FF1744';
                else elRate.style.color = '#888';
            }

            randomChatter() {
                const animals = ['dog', 'cat', 'mouse'];
                const who = animals[Math.floor(Math.random() * animals.length)];
                const texts = {
                    dog: ["ì°¨íŠ¸ê°€ ë¡±ì´ë‹¤ ë©!", "ì‚°ì±…ê°€ê³  ì‹¶ë‹¤...", "í‚í‚ ëˆëƒ„ìƒˆ!", "ì–‘ë´‰ì´ ë³´ì¸ë‹¤ ë©!"],
                    cat: ["ìˆì´ ì§„ë¦¬ë‹¤ëƒ¥", "ê°œë¯¸ í„¸ê¸°ë‹¤ëƒ¥", "ì¡¸ë¦¬ë‹¤ëƒ¥...", "í•˜í’ˆ...", "ë–¨ì–´ì ¸ë¼ ì–!"],
                    mouse: ["ê³ ë˜ í˜•ë‹˜ ì˜¤ì‹ ë‹¤ ì°!", "ë¬´ì„œì›Œ ì°...", "ì¹˜ì¦ˆ ë‚´ë†” ì°!", "ëˆˆì¹˜ê²Œì„ ì‹œì‘ ì°"]
                };
                if(Math.random() > 0.6) this.talk(who, texts[who][Math.floor(Math.random() * texts[who].length)]);
            }
        }

        const bot = new ZooBot();
    </script>
</body>
</html>
